#!/bin/bash
#Ensure so system is loaded
sleep 10
echo 17 > /sys/class/gpio/export
echo out > /sys/class/gpio/gpio17/direction
while true; do
    if [ -b /dev/sda1 ] && [ "$(cat /sys/class/gpio/gpio17/value)" == "0" ]; then
        mattrib -HS a:\*
        echo 1 > /sys/class/gpio/gpio17/value
    elif ! [ -b /dev/sda1 ]; then
        echo 0 > /sys/class/gpio/gpio17/value
    fi
    PROC=$(ps -ef | grep "canto-daemon" | grep -v "grep" | wc -l)
    if [ $PROC -eq 0 ]; then
        /usr/bin/canto-daemon -p 7070 &
    fi
    sleep 3
done
